{% extends 'src/base.html' %}
{% load static %}
{% block title %}
    {{ title }}
{% endblock title %}
{% block hero %}
    {% include 'src/partials/hero.html' %}
{% endblock %}
{% block content %}
        <!-- ======= Features Section ======= -->
    <section id="team" class="team">
      <div class="container">

        <div class="section-title" data-aos="fade-up">
          <h2>従業</h2>
          <p>クラス内容を見ましょう</p>
        </div>
      </div>
    </section><!-- End Features Section -->
    <section id="details" class="details" style="background-color: white">
      <div class="container" >
        <div class="row content" style="background-color: white">
          <div class="col-md-4 aos-init aos-animate" data-aos="fade-right">
            <img src="/{{ project.thumbnail.url }}" class="img-fluid" alt="">
          </div>
          <div class="col-md-8 pt-4 aos-init aos-animate" data-aos="fade-up">
            <p class="font-italic">
              {{ project.description }} {{ project.checkout_amount  }}
            </p>
          </div>
            <a href=""></a>
        </div>
          <div class="row">
            <div class="offset-8 col-md-4">
                <div id="paypal-button-container"></div>
{#                <form action="{% url 'payment' project.pk %}" method="post">#}
{#                    {% csrf_token %}#}
{#                    <div class="row">#}
{#                        <div class="col-lg-3">#}
{#                            <input type="text" placeholder="First Name" name="first_name" class="form-control" value="" required>#}
{#                        </div>#}
{#                        <div class="col-lg-3">#}
{#                            <input type="text" placeholder="Last Name" name="last_name" class="form-control"  value="" required>#}
{#                        </div>#}
{#                        <div class="col-lg-3">#}
{#                            <input type="email" placeholder="Email" name="email" class="form-control" value="" required>#}
{#                        </div>#}
{#                        <div class="col-lg-3">#}
{#                            <input type="submit" value="PAY NOW" class="btn btn-primary" href="{% url 'payment' project.pk %}">#}
{#                        </div>#}
{#                    </div>#}
{#                </form>#}
            </div>
          </div>
      </div>
    </section>
<script src="https://www.paypal.com/sdk/js?client-id=AV9Lx4zauCN_SmGw4e7lAByaf6LCDIZO0-201Y45Nit4Xdx6sKMRaiwd7hmDHy1TNFAOl9kZ5KuxcBx-"></script>
<script>
         function completeTransaction(response) {
             let url = "{% url 'paypal-success' %}"

            let data = {
                'response': JSON.stringify(response),
                'amount': "{{ project.price }}",
                'ref_id': "{{ project.pk }}",
                'type': 1
            }
              $.ajax({
                url: url,
                type: 'post',
                data: data,
                dataType: 'json',
                success: function (data) {
                  if (data) {
                    alert(data.message);
                    //location.reload()
                  }
                },
                error: function (error) {
                    if (error) {
                        console.log(error.message)
                    }
                }
            });
         }

    // Render Paypal buttons
     paypal.Buttons({
         style: {
             size: 'small',
             layout:  'vertical',
             shape: 'pill'
         },
        createOrder: function(data, actions) {
          return actions.order.create({
            purchase_units: [{
              amount: {
                value: "{{ project.price }}"
              }
            }]
          });
        },
         onApprove: function(data, actions) {
              // This function captures the funds from the transaction.
              return actions.order.capture().then(function(details) {
                  console.log(details)
                // This function shows a transaction success message to your buyer.
                completeTransaction(details)
              });
        }
      }).render('#paypal-button-container');
</script>
{% endblock content %}